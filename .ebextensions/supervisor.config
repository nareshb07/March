# .ebextensions/02-supervisor.config

files:
  "/opt/python/etc/supervisord.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      [supervisord]
      nodaemon=true
      logfile=/dev/stdout
      logfile_maxbytes=0

      [program:django]
      directory=/opt/python/current/app
      command=/opt/python/run/venv/bin/python manage.py runserver 0.0.0.0:8000
      autostart=true
      autorestart=true
      stdout_logfile=/dev/stdout
      stdout_logfile_maxbytes=0
      stderr_logfile=/dev/stderr
      stderr_logfile_maxbytes=0

  "/opt/python/etc/supervisord.d/channels.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      [program:channels]
      directory=/opt/python/current/app
      command=/opt/python/run/venv/bin/python manage.py runworker -v2
      autostart=true
      autorestart=true
      stdout_logfile=/dev/stdout
      stdout_logfile_maxbytes=0
      stderr_logfile=/dev/stderr
      stderr_logfile_maxbytes=0